var randcol= ~~(Math.random()*colors.length);particles.push({x:Math.random()*W,y:Math.random()* -H,r:randomFromTo(10,50),d:(Math.random()*mp)+10,color:colors[randcol],tilt:Math.floor(Math.random()*10)-10,tiltAngleIncremental:(Math.random()*0.07)+.05,tiltAngle:0,num:i })}};draw=function(timestamp){ctx.clearRect(0,0,W,H);for(var i=0;i<particles.length;i+=1){var p=particles[i];ctx.beginPath();ctx.lineWidth=p.r/2;ctx.strokeStyle=p.color;ctx.globalAlpha=1;ctx.moveTo(p.x+p.tilt+(p.r/4),p.y);ctx.lineTo(p.x+p.tilt,p.y+p.tilt+(p.r/4));ctx.stroke();}update(timestamp)};function randomFromTo(from,to){return Math.floor(Math.random()*(to-from+1)+from)}var TiltChangeCountdown=5;var angle=0;var tiltAngle=0;var oldtimestamp=0;var start=null;function update(timestamp){var dt=timestamp-oldtimestamp;oldtimestamp=timestamp;if(start===null){start=timestamp}if((timestamp-start)>maxconfettitime){endConfetti=true}angle+=0.02*dt;tiltAngle+=0.1*dt;TiltChangeCountdown=-1*dt;for(var i=0;i<particles.length;i+=1){var p=particles[i];p.tiltAngle+=p.tiltAngleIncremental;p.y+=(2*Math.cos(angle+p.d)+1+p.r/2)/2;p.x+=3*Math.sin(.1*angle+p.d);p.tilt=(Math.sin(p.tiltAngle-(p.num/3)))*15;if((p.x>W+5||p.x<-5||p.y>H)){if(endConfetti){particles.splice(i,1);}else{if(i%5>0||i%2==0){particles[i]={num:i,x:Math.random()*W,y:-10,r:p.r,d:p.d,color:p.color,tilt:Math.floor(Math.random()*10)-10,tiltAngle:p.tiltAngle,tiltAngleIncremental:p.tiltAngleIncremental}}else{if(Math.sin(angle)>0){particles[i]={num:i,x:-5,y:Math.random()*H,r:p.r,d:p.d,color:p.color,tilt:Math.floor(Math.random()*10)-10,tiltAngleIncremental:p.tiltAngleIncremental}}else{particles[i]={num:i,x:W+5,y:Math.random()*H,r:p.r,d:p.d,color:p.color,tilt:Math.floor(Math.random()*10)-10,tiltAngleIncremental:p.tiltAngleIncremental}}}}}}if(particles.length<1){StopConfetti()}else{requestAnimationFrame(draw)}}function StartConfetti(){$(canvas).addClass('active');ctx=canvas.getContext("2d");W=window.innerWidth;H=window.innerHeight;canvas.width=W;canvas.height=H;colors=['red','lightgreen','blue','cyan','orange','gold','lime','purple'];initConfetti();requestAnimationFrame(draw)}function StopConfetti(){$(canvas).removeClass('active');if(ctx==undefined){return}ctx.clearRect(0,0,W,H);start=null;endConfetti=false}
